%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                               %
%    		 pas-exos.sty         encodage : UTF8       	    %
%                                                               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                               %
%           	Créé par Stéphane PASQUET 		          		%
%                                                               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Informations générales
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{pas-exos}[2016/08/31]

%% Compteurs d'exercices

\newcounter{nbexos}
\setcounter{nbexos}{\z@}

% Chargement des extensions ----------------------------------->
\RequirePackage[latin1]{inputenc}
\RequirePackage[frenchb]{babel}
\RequirePackage[T1]{fontenc}
\RequirePackage{textcomp}
\RequirePackage{etex}
\RequirePackage{lmodern}
\RequirePackage[margin=2cm]{geometry}
\RequirePackage[svgnames,table]{xcolor}
\RequirePackage{mathrsfs}
\RequirePackage[explicit]{titlesec}
\RequirePackage{fancyhdr}
\RequirePackage[np]{numprint}
\RequirePackage{enumitem}
\RequirePackage{multicol}
\RequirePackage{eurosym}
\RequirePackage{tabularx}
\RequirePackage{cellspace}
\setlength{\cellspacetoplimit}{3pt}
\setlength{\cellspacebottomlimit}{3pt}
\RequirePackage{pas-algo}
\RequirePackage{mathtools}
\RequirePackage{tkz-euclide}
\RequirePackage{tkz-fct}
\RequirePackage{tkz-tab}
\usetikzlibrary{decorations.pathmorphing}
\RequirePackage{pas-math}
\RequirePackage{cancel}
\RequirePackage{systeme}
\RequirePackage{ulem}
\RequirePackage{setspace}
\RequirePackage{xkeyval}
\RequirePackage{pifont}

% Couleurs ------------------------------------------->

\def\color@toc@chapter{violet}
\def\color@toc@section{purple}
\def\colorItem{purple}
\def\colorItemBg{purple!40}
\def\colorExTitle{violet}
\definecolor{violet}{cmyk}{0.28,0.89,0,0.28}
\definecolor{vert}{cmyk}{0.17,0,0.17,0.07}
\RequirePackage[colorlinks=true,urlcolor=violet,linkcolor=violet]{hyperref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%% Tables des matières %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{secnumdepth}{0}
\addto\captionsfrench{\renewcommand{\contentsname}{Sommaire}}

\newcommand{\chaptertoccolor}{\color@toc@chapter}
\newcommand{\sectiontoccolor}{\color@toc@section}


\renewcommand*\l@chapter[2]{%
  \ifnum\c@tocdepth>\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.9em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode \bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      \def\@linkcolor{\chaptertoccolor}%
      \color{\chaptertoccolor}{\mathversion{bold}\fontfamily{phv}\fontseries{b}\selectfont#1}\nobreak\
       \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep
        mu$}\hfil\nobreak\hb@xt@\@pnumwidth{\hss
        \def\@linkcolor{\chaptertoccolor}%
        \color{\chaptertoccolor}#2}\par
      \penalty\@highpenalty
    \endgroup
  \fi}
  
\def\@dottedtocline#1#2#3#4#5{%
  \ifnum #1>\c@tocdepth \else
    \vskip \z@ \@plus.9\p@
    {\leftskip #2\relax\rightskip \@tocrmarg \parfillskip -\rightskip
     \parindent #2\relax\@afterindenttrue
     \interlinepenalty\@M
     \leavevmode
     \@tempdima #3\relax
     \advance\leftskip \@tempdima \null\nobreak\hskip -\leftskip
     {#4}\nobreak
     \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep
        mu$}\hfill
     \nobreak
     \hb@xt@\@pnumwidth{\hfil #5}%
     \par}%
  \fi}
  
\def\contentsline#1#2#3#4{%
	\fontfamily{lmss}\selectfont
  \ifx\\#4\\%
    \csname l@#1\endcsname{#2}{#3}%
  \else
      \csname l@#1\endcsname{\hyper@linkstart{link}{#4}{#2}\hyper@linkend}{%
        \hyper@linkstart{link}{#4}{#3}\hyper@linkend
      }%
  \fi
}

\renewcommand*\l@section{\color{\sectiontoccolor}\def\@linkcolor{\sectiontoccolor}\@dottedtocline{1}{1pt}{3.5em}}

\pagestyle{fancy}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\headrulewidth}{0pt}
\lhead{}
\chead{}
\rhead{}
\cfoot{\fontfamily{lmss}\selectfont\color{purple}\thepage}
%\lfoot{\fontfamily{lmss}\small\color{violet} St\'ephane PASQUET}
%\rfoot{\fontfamily{lmss}\small\url{http://www.mathweb.fr}}
\setlength{\parindent}{0cm}


%<-------------- Définition des titres de section ----------------->

\renewcommand{\thechapter}{\@Roman\c@chapter}

%
\titleformat{\chapter}
  {}
  {}{0pt}
  {%
  	\thispagestyle{fancy}
	\begin{tikzpicture}
\fill[blue!20] (0,0) rectangle+(\textwidth,-1.5cm);
\fill[orange!5] (0,-1) rectangle +(\textwidth,-5cm);
\fill[violet] (12cm,0) rectangle +(4cm,-4.5cm);
\fill[violet!80] (12cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!70] (12.5cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!60] (13cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!60] (12cm,-4cm) rectangle+(0.5cm,0.5cm);
\fill[violet!50] (12.5cm,-4cm) rectangle+(0.5cm,0.5cm);
\fill[violet!40] (12cm,-3.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!40] (13.5cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[vert] (12cm,-4.5cm) rectangle +(4cm,-1.5cm);
\node[below] at (14cm,-0.5cm) {%
\begin{minipage}{4cm}
\if@mainmatter
\begin{center}
\color{white}\fontfamily{lmss}\fontseries{b}\selectfont{\Large \'Enonc\'es}
\end{center}
\fi
\end{minipage}
};
% Titre
\node[below right] (titre) at (0.25cm,-1.5cm) {%
\begin{minipage}{11cm}
\fontfamily{lmss}\fontseries{b}\selectfont\color{purple}\Huge #1
\end{minipage}
};
\node[below right,text=purple] (url) at ($(titre.south west)+(0,-1em)$) {\fontfamily{lmss}\fontshape{it}\selectfont Disponible sur \url{http://www.mathweb.fr}};
\if@mainmatter
\node[below right,circle,fill=\colorExTitle,text=white,scale=0.5] (legendeA) at ($(url.south west)+(0,-1em)$) {\fontfamily{lmss}\fontseries{b}\selectfont A};
\node[right,scale=0.8] at (legendeA.east) {\fontfamily{lmss}\selectfont Exercices d'application du cours};
\node[below right,circle,fill=\colorExTitle,text=white,scale=0.5] (legendeR) at ($(url.south west)+(0,-2.5em)$) {\fontfamily{lmss}\fontseries{b}\selectfont R};
\node[right,scale=0.8] at (legendeR.east) {\fontfamily{lmss}\selectfont Exercices de r\'eflexion};
\node[below right,text=gray] (legendeV) at ($(url.south west)+(-0.15,-4em)$) {\large\ding{44}};
\node[right,scale=0.8] at ($(legendeV.east)+(-0.1,0)$) {\fontfamily{lmss}\selectfont Exercice \& corrig\'e relus avec attention pour \'eviter les erreurs};
\fi
% Date
\node at (14cm,-5.5cm) {%
\begin{minipage}{4cm}
\begin{center}
\fontfamily{lmss}\fontseries{b}\selectfont\color{black}\today
\end{center}
\end{minipage}
};
\end{tikzpicture}
  }
\titlespacing*{\chapter}{0pt}{0pt}{-10pt}

% <------------- Exercice -------------------------->

\define@cmdkey [PAS] {exo}{N}{} % niveau (sur 5)
\define@cmdkey [PAS] {exo}{style}{} % Réflexion, application du cours, 
\define@boolkey[PAS] {exo} {verif}[true]{}
\presetkeys    [PAS] {exo} {style= , N= , verif=false}{}

\newcommand*{\exercice}[1][]{\pasexo[#1]}

\newcounter{numexos}[chapter]
\setcounter{numexos}{\z@}

\xdef\namefic{}

\long\def\pasexo[#1]#2{
    \setkeys[PAS]{exo}{#1}
    \stepcounter{nbexos}
	\stepcounter{numexos}
	\addcontentsline{toc}{section}{\thechapter.\thenumexos~~#2}
	\ifnum\thenumexos>1\par\bigskip\fi
	\ifPAS@exo@verif
		\def\symb@verif{\large\color{gray}\,\ding{44}}
	\else
		\def\symb@verif{}
	\fi
	\begingroup
	\color{\colorExTitle}
	{\small\hyperref[toc]{\color{\colorExTitle}$\blacksquare$}}~\fontfamily{lmss}\fontseries{b}\selectfont Exercice \thenumexos. #2\hfill
	\ifnum\cmdPAS@exo@N=1\ding{72}\ding{73}\ding{73}\ding{73}\ding{73}\fi
	\ifnum\cmdPAS@exo@N=2\ding{72}\ding{72}\ding{73}\ding{73}\ding{73}\fi
	\ifnum\cmdPAS@exo@N=3\ding{72}\ding{72}\ding{72}\ding{73}\ding{73}\fi
	\ifnum\cmdPAS@exo@N=4\ding{72}\ding{72}\ding{72}\ding{72}\ding{73}\fi
	\ifnum\cmdPAS@exo@N=5\ding{72}\ding{72}\ding{72}\ding{72}\ding{72}\fi	
	\enspace
	\tikz\node[circle,fill=\colorExTitle,text=white,scale=0.5] {\fontfamily{lmss}\fontseries{b}\selectfont\cmdPAS@exo@style};
	\par\begingroup\ifx\namefic\@empty\else\small\fontseries{n}\selectfont\color{gray}(Source : \namefic\numsrc)\fi\endgroup\hfill\scalebox{0.75}{\tikz\node[rectangle,rounded corners=3pt,draw,outer ysep=3pt,outer xsep=0pt,inner sep=3pt] {Corrig\'e page \pageref{corr-\thechapter-\thenumexos}\symb@verif};}%
	\endgroup
	\vskip0.5em
}

% Titre de la correction

\newcommand*\correction
{%
	\newpage
	\begin{tikzpicture}
\fill[blue!20] (0,0) rectangle+(\textwidth,-1.5cm);
\fill[orange!5] (0,-1) rectangle +(\textwidth,-5cm);
\fill[violet] (12cm,0) rectangle +(4cm,-4.5cm);
\fill[violet!80] (12cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!70] (12.5cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!60] (13cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!60] (12cm,-4cm) rectangle+(0.5cm,0.5cm);
\fill[violet!50] (12.5cm,-4cm) rectangle+(0.5cm,0.5cm);
\fill[violet!40] (12cm,-3.5cm) rectangle+(0.5cm,0.5cm);
\fill[violet!40] (13.5cm,-4.5cm) rectangle+(0.5cm,0.5cm);
\fill[vert] (12cm,-4.5cm) rectangle +(4cm,-1.5cm);
\node[below] at (14cm,-0.5cm) {%
\begin{minipage}{4cm}
\if@mainmatter
\begin{center}
\color{white}\fontfamily{lmss}\fontseries{b}\selectfont{\Large Corrig\'es}
\end{center}
\fi
\end{minipage}
};
% Titre
\node[below right] (titre) at (0.25cm,-1.5cm) {%
\begin{minipage}{11cm}
\fontfamily{lmss}\fontseries{b}\selectfont\color{purple}\Huge
\end{minipage}
};
% Date
\node at (14cm,-5.5cm) {%
\begin{minipage}{4cm}
\begin{center}
\fontfamily{lmss}\fontseries{b}\selectfont\color{black}\today
\end{center}
\end{minipage}
};
\end{tikzpicture}
	\setcounter{numexos}{\z@}
}

\newcommand*\corrige
{%
	\refstepcounter{numexos}
	\par
	\ifnum\thenumexos>1\bigskip\fi
	\begingroup
	\color{\colorExTitle}
	{\small\hyperref[toc]{\color{\colorExTitle}$\blacksquare$}}~\fontfamily{lmss}\fontseries{b}\selectfont Corrig\'e de l'exercice \thenumexos.\label{corr-\thechapter-\thenumexos}
	\endgroup
}

% multicolonne

\setlength{\columnseprule}{0pt}
\setlength{\columnsep}{1em}

% Listes

\setlist[itemize,1]{label={\color{\colorItem}\textbullet}}
\setlist[itemize,2]{label={\color{\colorItem}$\rightarrow$}}
\setlist[enumerate,1]
	{%
		label=\fcolorbox{\colorItemBg}
		{\colorItemBg}
		{\color{\colorItem}\normalsize\bfseries\arabic*}
	}
\setlist[enumerate,2]
	{%
	  label=\textcolor{\colorItem}{\normalsize$\alph*.$}
	}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%% Page de garde %%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\maketitle}
{%
\newpage
\newgeometry{margin=0cm}
\noindent
\begin{tikzpicture}
\clip (current page.south west) rectangle (current page.north east);
% cadre
\draw[line width=2pt,blue!20] ($(current page.south west)+(1,1)$) rectangle ($(current page.north east)+(-1,-1)$);
% dégradé radial
\shade[inner color=vert!10,outer color=vert!70] ($(current page.south west)+(2,2)$) rectangle ($(current page.north east)+(-2,-2)$);
%
\fill[fill=white] ($(current page.north east)+(-12,-2)$) rectangle ($(current page.north east)+(-5,-20)$);
%
\fill[blue!20] ($(current page.north east)+(-11.75,-2)$) rectangle ($(current page.north east)+(-5.25,-10)$);
% Date
\node[text=white,above left] at  ($(current page.north east)+(-5.5,-10)$) {\fontfamily{lmss}\fontseries{b}\selectfont\@date};
% Title
\node[below right,text=violet, text width=6.5cm] at ($(current page.north east)+(-11.75,-11)$) {\begin{spacing}{1.5}
\fontfamily{lmss}\fontseries{b}\Huge\@title\end{spacing}};
%
\fill[violet!60] ($(current page.north east)+(-11.75,-19.25)$) rectangle ($(current page.north east)+(-5.25,-19.75)$);
%
\node[text=white,below right,text width=6.5cm] at  ($(current page.north east)+(-11.75,-19.25)$) {\fontfamily{lmss}\fontseries{b}\small\@author};
\end{tikzpicture}
\restoregeometry
}
\endinput
